# Стабилизация работы Selenium
Selenium в отличии от предыдущих технологий, с которыми мы работали, не очень стабилен. Раньше для запуска вашей программы на другом компьютере было необходимо установить Python и библиотеки нужных версий из файла requirements, который вы создавали.

C Selenium все немного сложнее. Это автоматизация браузера. Однако, Selenium хорошо работает не со всеми версиями Chrome, Selenium может не найти драйвер на компьютере, Selenium может найти не тот драйвер (если у вас установлено несоклько браузеров, основанных на Chrome), Selenium может запустить нужный драйвер, но он не будет иметь доступа ко всем фукнкциям и т.д.

**Так же стоит учитывать, что используемый Selenium драйвер должен соответствовать драйверу, который использует обычный браузер**

Это все решается, хоть и придется немного покопаться

## Стабилизация версии драйвера

Чтобы Selenium точно находил нужный нам драйвер, нужной версии, которая точно хорошо подходит для автоматизации, можно воспользоваться библиотекой `webdriver_manager`. Она является дополнением к библиотеке Selenium. Хотя, вы конечно, можете использовать ее и отдельно, если придумаете, для чего...

Библиотека позволяет управлять версиями веб драйверов. Она более точно находит драйвер на компьютере, узнает его версию, и сама скачивает для Selenium'а необходимую версию драйвера, подходящую для автоматизации установленного на компьютере браузера

Библиотеку необходимо скачать:
```
pip install webdriver_manager
```

И импортировать:

Для Хром
```python
from webdriver_manager.chrome import ChromeDriverManager
```
Для Мозилы 
```python
from webdriver_manager.firefox import GeckoDriverManager
```

Так же для указания определенной версии драйвера, которую будет использовать Selenium, необходимо импортировать объект `Service`:
```python
from selenium.webdriver.chrome.service import Service
```

После **перед запуском драйвера** добавляем строку:
```python
service = Service(ChromeDriverManager().install())
```

Объект `Service` нужен для указания определенного драйвера, используемого Selenium. А `ChromeDriverManager().install()` найдет последнюю установленную на компьютере версию драйвера для браузера и скачает соответстующую версию веб драйвера для Selenium, поддерживающую все фукнции автоматизации

После строчку, которая запускала драйвер и сохраняла его в переменную driver, дополняем аргументом с указанием нашей переменной `service`:
```python
driver = webdriver.Chrome(service=service)
```

Теперь перед запуском драйвера программа будет проверять и при необходимости устанавливать подходящую версию драйвера

### В дополнение
В зависимости от версии драйвера сайты немного по разному отображаются, хотя обычному пользователю это и незаметно. Иногда случаются ситуации, когда необходимо использовать определенную версию драйвера, так как только на нем страница отображается наиболее удобным для автоматизации образом.

В таком случае, нам придется удалить браузер хром с компьютера (и сервера) и установить его заново, но определенной версии. А в коде явно указать номер версии, которую будет скачивать `webdriver_manager`:

```python
service = Service(ChromeDriverManager(driver_version="107.0.5304.88").install())
```
(Версия `"107.0.5304.88"` указана для примера)

Удалять и скачивать заново браузер нужной версии не очень то удобно. Поэтому, если планируется, что программа будет работать на Windows, вы можете скачать и установить прямо в папку проекта portable версию браузера хром. То-есть она установится прямо в папку проекта и использоваться будет только внутри проекта. 

**Однако, такие версии неофициальны, поэтому неисключена возможность содержания в них вредоносного кода, и скачивать их вам придется на свой страх и риск**

Если все же до этого дошло, то после установки такой версии в папку проекта, будет необходимо, как описывалось выше, указать точную версию данного бразуреа (а значит, и его драйвера)

Так же придется указать определенные опции запуска (натройки). Подробнее о них так же будет ниже

```python
from selenium.webdriver.chrome.options import Options

chrome_options = Options()
chrome_options.binary_location = './GoogleChromePortable/GoogleChromePortable.exe'
```
**Альтеранативный метод импортирования представлен в разделе Антибот проверки**

В `chrome_options.binary_location` необходимо указать путь до запускаемого `.exe` файла установленной вами в папку проекта portable версии

Помимо прочего, дополняем аргументом `options` строчку запуска драйвера:
```python
driver = webdriver.Chrome(service=service, options=chrome_options)
```

## Опции запуска
Опции (настройки) запуска нашего драйвера - важная вещь, без которой не обойдется ни один реальный проект.
Возможно, вы уже стокнулись с проблемами, когда пробовали код из статьи по базовому использованию Selenium. Часть из них решается версией драйвера, а часть опциями запуска

Опций запуска великое множество, но полезных для нас будет лишь 10-20 из них

Для использования опций, нобходимо импортировать объект из библиотеки и создать переменную `chrome_options`:

```python
from selenium.webdriver.chrome.options import Options

chrome_options = Options()
```
Или 
```python
from selenium import webdriver

chrome_options = webdriver.ChromeOptions()
```


## Антибот проверки
Если вы пробовали заходить с помощью запущенного драйвера на разные сайты, наверняка вы замечали, что некоторые сайты постоянно запрашивают капчу, а некоторые и вовсе не пускают

Это происходит из за того, что сайты видят, что вы используете автоматизацию браузера (Selenium) и распознают вас как бота. Нечто похожее было и при использовании  `bs4`. Там это базово решалось добавлением `user-agent` к запросу на сайт.

Но у нас не простой запрос, поэтому только этим мы не отделаемся

### Проверка анонимности браузера

Прежде чем писать основной код программы - парсера, убедитесь в том, что запущенный Selenium драйвер (браузер) проходит все требования по антидетекту ботов. Это можно сделать на сайтах:
- [sannysoft](https://bot.sannysoft.com)
- [browserscan](https://browserscan.net/)

Все или хотя бы (90%) показателей должны быть зелеными


